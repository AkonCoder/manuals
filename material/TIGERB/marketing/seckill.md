# 秒杀系统

> 5张图给你5种秒杀系统

## 一个简单的秒杀系统

**实现原理：** 通过redis原子操作减库存

<p align="center">
    <a href="http://cdn.tigerb.cn/20200501175532.png">
        <img src="http://cdn.tigerb.cn/20200501175532.png" width="100%">
    </a>
</p>

优点|缺点
------------|------------
简单好用|考验redis服务能力

|是否公平|
|-------|
|公平|
|先到先得|

我们称这类秒杀系统为：

> 简单秒杀系统

## 一个够用的秒杀系统

**实现原理：** 服务内存限流算法 + redis原子操作减库存

<p align="center">
    <a href="http://cdn.tigerb.cn/20200501183037.png">
        <img src="http://cdn.tigerb.cn/20200501183037.png">
    </a>
</p>

优点|缺点
------------|------------
简单好用|减少了redis的压力

|是否公平|
|-------|
|不公平|
|相对的先到先得|

我们称这类秒杀系统为：

> 够用秒杀系统

## 性能再好点的秒杀系统 

**实现原理：** 服务本地内存原子操作减库存

服务本地内存的库存怎么来的？
活动开始前分配好每台机器的库存，推送到机器上

<p align="center">
    <a href="http://cdn.tigerb.cn/20200501181136.png">
        <img src="http://cdn.tigerb.cn/20200501181136.png">
    </a>
</p>

优点|缺点
------------|------------
高性能|不支持动态伸缩容(活动进行期间)，因为库存是活动开始前分配好的
释放了redis压力|-

|是否公平|
|-------|
|不公平|
|不是绝对的先到先得|


我们称这类秒杀系统为：

> 预备库存秒杀系统

## 支持动态伸缩容的秒杀系统

**实现原理：** 服务本地Goroutine**定时redis原子操作减部分库存**到本地内存 + 服务本地内存原子操作减库存

<p align="center">
    <a href="">
        <img src="">
    </a>
</p>

优点|缺点
------------|------------
高性能|支持动态伸缩容(活动进行期间)
释放了redis压力|-

|是否公平|
|-------|
|不公平|
|几乎先到先得|

我们称这类秒杀系统为：

> 实时预备库存秒杀系统

## 公平的秒杀系统

**实现原理：** 服务本地Goroutine**定时同步是否售罄**到本地内存 + 队列 + 排队成功轮训结果

判断redis队列长度是否大于等于总库存

<p align="center">
    <a href="">
        <img src="">
    </a>
</p>

优点|缺点
------------|------------
高性能|开发成本高(需要通知或轮训排队结果)
释放了redis压力|-

|是否公平|
|-------|
|公平|
|绝对的先到先得|

我们称这类秒杀系统为：

> 公平排队秒杀系统

## 进一步追求完美的秒杀系统

> 上面的秒杀系统还不够完美吗？

是的。

> 还有什么优化的空间？

答案：静态化获取秒杀活动信息的接口。

静态化是什么意思

比如获取秒杀活动信息是通过接口 `https://seckill.skrshop.tech/v1/acticity/get` 获取的。现在呢，我们需要通过`https://static-api.skrshop.tech/seckill/v1/acticity/get` 这个接口获取。有什么区别呢？看下面：

服务名|接口|数据存储位置
------|------|------
秒杀服务|https://seckill.skrshop.tech/v1/acticity/get|秒杀服务内存或redis等
接口静态化服务|https://static-api.skrshop.tech/seckill/v1/acticity/get|CDN、本地文件

结果：可以通过接口`https://static-api.skrshop.tech/seckill/v1/acticity/get`就获取到了秒杀活动信息，流量都分摊到了cdn，秒杀服务自身没了这部分的负载。

之后我们会分享`如何用Golang设计一个好用的**接口静态化服务**`。

<p align="center">
    <a href="">
        <img src="">
    </a>
</p>

看产品

秒杀活动对外的宣称

绝对先到先得

先到先得

先到先得是相对的 文字游戏

最好的不一定是你的，最不好的不一定不适合你